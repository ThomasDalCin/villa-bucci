<!--main navbar -->
<div
    class="navigation fixed left-0 top-0 right-0 z-100 w-full h-auto px-4 py-3.5 transform transition-all duration-300 ease-in">
    <div class="w-full h-auto flex flex-row items-center justify-between">
        <!--container logo-->
        <div class="w-auto h-auto">
            <svg class="oniwines-logo" xmlns="http://www.w3.org/2000/svg" width="152" height="37" viewBox="0 0 152 37"
                fill="none">
                <path
                    d="M15.2717 13.2872C14.7053 14.3212 13.9381 15.1358 12.9559 15.7307C11.9736 16.3257 10.8838 16.6231 9.68642 16.6231C8.48906 16.6231 7.42792 16.3257 6.44565 15.7307C5.46339 15.1358 4.69623 14.3212 4.14415 13.2872C3.59207 12.2531 3.31245 11.1057 3.31245 9.84498C3.31245 8.58426 3.59207 7.44393 4.14415 6.43111C4.69623 5.41828 5.46339 4.61085 6.44565 4.0159C7.42792 3.42096 8.51057 3.12348 9.68642 3.12348C10.8623 3.12348 11.9736 3.42096 12.9559 4.0159C13.9381 4.61085 14.7124 5.41828 15.2717 6.43111C15.8309 7.44393 16.1177 8.58426 16.1177 9.84498C16.1177 11.1057 15.8381 12.2531 15.2717 13.2872ZM14.6264 1.28906C13.1423 0.43205 11.4932 0 9.67925 0C7.86528 0 6.24491 0.43205 4.7751 1.28906C3.30529 2.14606 2.13661 3.33595 1.2834 4.84457C0.430195 6.35318 0 8.02471 0 9.85205C0 11.6794 0.430195 13.3792 1.2834 14.8879C2.13661 16.3965 3.29812 17.5864 4.7751 18.4505C6.24491 19.3216 7.87962 19.7537 9.67925 19.7537C11.4789 19.7537 13.1423 19.3216 14.6264 18.4505C16.1106 17.5793 17.2721 16.3965 18.1181 14.8879C18.9641 13.3792 19.3872 11.7006 19.3872 9.85205C19.3872 8.00346 18.9641 6.35318 18.1181 4.84457C17.2721 3.33595 16.1106 2.15315 14.6264 1.28906Z"
                    fill="#262A39" />
                <path d="M50.1886 0.276367H46.998V19.4776H50.1886V0.276367Z" fill="#262A39" />
                <path
                    d="M72.4938 27.155C72.4938 26.0643 71.6191 25.186 70.5365 25.186C69.4538 25.186 68.5791 26.0643 68.5791 27.155C68.5791 28.2458 69.4538 29.124 70.5365 29.124C71.6191 29.124 72.4938 28.2458 72.4938 27.155Z"
                    fill="#262A39" />
                <path
                    d="M70.5365 33.062C69.4538 33.062 68.5791 33.9403 68.5791 35.031C68.5791 36.1217 69.4538 37 70.5365 37C71.6191 37 72.4938 36.1217 72.4938 35.031C72.4938 33.9403 71.6191 33.062 70.5365 33.062Z"
                    fill="#262A39" />
                <path
                    d="M68.1198 27.155C68.1198 26.0643 67.2451 25.186 66.1624 25.186C65.0798 25.186 64.2051 26.0643 64.2051 27.155C64.2051 28.2458 65.0798 29.124 66.1624 29.124C67.2451 29.124 68.1198 28.2458 68.1198 27.155Z"
                    fill="#262A39" />
                <path
                    d="M72.723 29.1245C71.6403 29.1245 70.7656 30.0028 70.7656 31.0935C70.7656 32.1842 71.6403 33.0625 72.723 33.0625C73.8056 33.0625 74.6803 32.1842 74.6803 31.0935C74.6803 30.0028 73.8056 29.1245 72.723 29.1245Z"
                    fill="#262A39" />
                <path
                    d="M70.3073 31.0935C70.3073 30.0028 69.4326 29.1245 68.3499 29.1245C67.2673 29.1245 66.3926 30.0028 66.3926 31.0935C66.3926 32.1842 67.2673 33.0625 68.3499 33.0625C69.4326 33.0625 70.3073 32.1842 70.3073 31.0935Z"
                    fill="#262A39" />
                <path
                    d="M74.889 25.186C73.8064 25.186 72.9316 26.0643 72.9316 27.155C72.9316 28.2458 73.8064 29.124 74.889 29.124C75.9716 29.124 76.8464 28.2458 76.8464 27.155C76.8464 26.0643 75.9716 25.186 74.889 25.186Z"
                    fill="#262A39" />
                <path
                    d="M126.404 0.920642C130.526 0.920642 132.462 4.18576 132.899 6.1335H120.087C120.976 2.92504 123.263 0.920642 126.404 0.920642ZM128.139 18.1812C123.17 18.1812 119.714 14.6257 119.714 9.13658C119.714 8.4354 119.779 7.76253 119.893 7.11801H135.079C135.079 7.11801 135.058 6.48764 134.986 6.06976V6.0556C134.47 2.59924 131.752 0.283203 127.73 0.283203C122.052 0.283203 117.8 4.56114 117.8 10.4256C117.8 16.7859 122.618 19.8527 126.755 19.8527C130.404 19.8527 133.301 17.5437 135.409 14.8948L135.108 14.5903C133.186 16.7859 131.193 18.1883 128.146 18.1883"
                    fill="#262A39" />
                <path
                    d="M145.669 8.98094C143.195 8.18768 140.234 7.12527 140.234 4.39843C140.234 2.16738 141.998 0.913731 144.729 0.913731C147.318 0.913731 149.791 2.38694 150.91 5.19169L151.211 5.11377L151.06 1.55826C150.014 1.10497 147.949 0.460449 145.174 0.460449C141.654 0.460449 138.843 2.39402 138.843 5.49624C138.843 9.01635 141.539 9.85211 144.651 10.9074C147.16 11.7786 150.573 12.5364 150.573 15.6033C150.573 18.1743 148.623 19.4279 146.264 19.4279C142.815 19.4279 140.155 17.6077 138.657 14.0521L138.355 14.1301L138.621 18.3726C139.668 19.0525 142.22 20.0724 145.518 20.037C149.039 20.0016 152 17.9193 152 14.3567C152 10.7941 148.365 9.85211 145.669 8.98094Z"
                    fill="#262A39" />
                <path
                    d="M108.307 0.283473C104.629 0.184316 101.123 3.21571 99.961 4.32769V0.510103L99.6957 0.276384L96.4407 1.70001V2.04706C97.5735 2.54285 97.9606 2.8899 97.9678 5.91421C96.0033 7.86904 93.7376 9.92303 91.1924 12.0549V0.503035L90.9271 0.269294L87.672 1.69292V2.03997C88.8191 2.54284 89.2063 2.8899 89.2063 6.04878V13.6839C88.2312 14.4701 87.2203 15.2634 86.1735 16.0708C81.6278 19.5626 77.2184 21.737 73.0456 22.5373C68.1199 23.4793 63.3735 22.509 59.6595 19.7822L59.0859 20.5754C62.0399 22.7427 65.6176 23.8689 69.4105 23.8689C70.6652 23.8689 71.9414 23.7485 73.2248 23.5006C77.541 22.6719 82.0939 20.4338 86.7614 16.8499C87.6003 16.2054 88.4105 15.5679 89.1991 14.9376V19.8247H91.1924V13.3156C93.7233 11.2262 95.9889 9.20768 97.9678 7.2741V19.8176H99.961V5.69465C103.89 1.74958 106.55 1.28213 107.683 1.31754C110.988 1.68584 112.558 3.96647 112.558 8.15235V19.8105H114.552V7.33784C114.552 2.79074 112.329 0.248047 108.314 0.248047"
                    fill="#262A39" />
                <path
                    d="M63.467 19.6902H65.1376L70.4719 3.75415L76.0716 19.6902H77.7206L80.9255 8.46415L82.295 3.42833C82.3882 3.10961 82.6176 2.03306 83.1051 1.38853C83.3274 1.09814 83.6142 0.977736 83.9584 0.85733V0.439453H80.2874V0.85733C80.947 0.991902 81.3342 1.42395 81.4776 2.11805C81.5636 2.53593 81.5134 2.97504 81.3987 3.38584L77.3549 17.36L71.5044 0.708578L71.4829 0.637768L71.4112 0.439453H70.5651L64.8938 17.3954L61.3376 5.14236C60.341 1.74974 60.4199 1.14062 61.4882 0.864398V0.446521H57.1289V0.864398C57.8961 1.21145 58.2761 1.74974 59.2727 5.14236L63.4814 19.6973L63.467 19.6902Z"
                    fill="#262A39" />
                <path
                    d="M37.5125 13.9455L27.1162 0.176758H24.3057V19.5692H27.5823V5.82876L37.9785 19.5692H40.7962V0.176758H37.5125V13.9455Z"
                    fill="#262A39" />
            </svg>
        </div>
        <!--container menu box -->
        <div class="container w-auto h-auto flex flex-row items-center justify-start gap-x-9">
            <div class="w-auto h-auto show-active-language hidden lg:block">
                <p class="text-[12px] uppercase font-bold active-language"></p>
            </div>
            <div class="menu-box">
                <div class="line line1"></div>
                <div class="line line2"></div>
            </div>
        </div>
    </div>
</div>


<!--container full screen navigation-->
<div
    class="navigation-container fixed inset-1.5 z-60 bg-(--blue-color) rounded-[8px] flex flex-col items-start justify-center hidden">
    <div class="w-full h-full flex flex-col items-start justify-between pt-16">

        <div
            class="w-full flex flex-col items-start justify-center lg:flex-row lg:h-full lg:border lg:border-t-(--border-color)">
            <div
                class="w-full flex flex-col items-start justify-between lg:h-full lg:border lg:border-r-(--border-color)">
                <!--assign variable for each reference link into links menu-->
                {% assign menuLinks = "Home,Il progetto,Contatti" | split: "," %}
                {% for menuLink in menuLinks %}
                {% for linkItem in linklists.main-menu.links %}
                {% if linkItem.title == menuLink %}
                <div
                    class="w-full flex flex-col items-start justify-center p-2.5 border border-b-(--border-color) first:border-t first:border-t-(--border-color) lg:flex-1 lg:border-0 lg:border-t-0 lg:first:border-0 lg:even:border lg:even:border-t-(--border-color) lg:even:border-b-(--border-color) group">
                    <div class="w-full h-auto flex flex-row items-center justify-start lg:gap-x-5">

                        <!--icon link-->
                        <div class="container-arrow-link w-auto h-auto hidden">
                            {% render 'arrow-up' %}
                        </div>

                        <!--container link-->
                        <div class="w-auto h-auto">
                            <li class="list-none">
                                <a class="main-menu-link text-(--link-color) text-[24px] leading-normal lg:text-[96px] lg:group-hover:text-(--orange-color) transition-all duration-200 ease-in"
                                    href="{{ linkItem.url }}">{{
                                    linkItem.title |
                                    upcase }}</a>
                            </li>
                        </div>
                    </div>
                </div>
                {% endif %}
                {% endfor %}
                {% endfor %}
            </div>

            <div class="w-full flex flex-col items-start justify-between lg:h-full">

                <!--assign variable for each reference link into links menu-->
                {% assign menuLinks = "Le cantine,Prodotti" | split: "," %}
                {% for menuLink in menuLinks %}
                {% for linkItem in linklists.main-menu.links %}
                {% if linkItem.title == menuLink %}
                <div
                    class="w-full  flex flex-col items-start justify-center p-2.5 border border-b-(--border-color) transition-all duration-200 ease-linear lg:flex-1 lg:border-0 lg:first:border lg:first:border-b-(--border-color)">
                    <div class="w-full h-auto flex flex-row items-center justify-between"
                        data-target="link-item-{{ forloop.index }}">
                        <!--container link-->
                        <div class="w-auto h-auto">
                            <li class="list-none">
                                <a class="text-link text-(--link-color) text-[24px]  leading-normal transition-all duration-200 ease-linear lg:text-[96px] lg:opacity-[0.3]"
                                    href="javascrip:void(0)">{{ linkItem.title |
                                    upcase }}</a>
                            </li>
                        </div>
                        <!--container arrow right-->
                        <div class="w-auto h-auto container-arrow transition-all duration-200 ease-in-out lg:hidden">
                            {% render 'arrow-right' %}
                        </div>
                    </div>
                    {% if linkItem.links.size > 0 %}
                    <div class="container-childlinks overflow-hidden w-full flex flex-col items-start justify-start gap-y-1.5 h-0 transition-all duration-200 ease-linear lg:h-auto lg:overflow-auto lg:mt-20"
                        data-child-link="link-item-{{ forloop.index }}">

                        <div class="container-arrow-link w-auto h-auto hidden">
                            {% render 'arrow-up' %}
                        </div>

                        {% for childlinks in linkItem.links %}
                        <!--content childlinks-->
                        <div class="w-full h-auto flex flex-row items-center justify-start lg:gap-x-1">

                            <div class="container-arrow-link w-auto h-auto hidden">
                                {% render 'arrow-up' %}
                            </div>

                            <li class="list-none">
                                <a class="main-menu-sublink text-(--link-color) text-[24px] leading-normal lg:hover:text-(--orange-color) transition-all duration-200 ease-linear"
                                    href="{{ childlinks.url }}">{{
                                    childlinks.title |
                                    upcase }}</a>
                            </li>
                        </div>
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>
                {% endif %}
                {% endfor %}
                {% endfor %}
            </div>
        </div>


        <div
            class="w-full flex flex-col items-start justify-between lg:flex-row-reverse lg:relative lg:border lg:border-t-(--border-color) lg:border-l-0 lg:border-r-0 lg:border-b-0">

            <!--container switch language form-->
            <div class="w-full px-2.5 py-5 flex items-center justify-center border border-(--border-color) lg:border-0">
                {% form 'localization', id: "localization_form_tag" %}
                <div
                    class="w-auto h-auto flex flex-row items-center justify-start gap-x-5 lg:absolute lg:top-1/2 lg:left-1/2 lg:-translate-x-1/2 lg:-translate-y-1/2">
                    {% for locale in shop.published_locales %}
                    <button class="language-button w-auto h-auto text-[#E3DBD2] text-[12px]" type="button" tabindex="0"
                        data-locale-code="{{ locale.iso_code }}">
                        {% case locale.endonym_name %}
                        {% when "Italiano" %} IT
                        {% when "English" %} EN
                        {% else %}
                        {% endcase %}
                    </button>
                    {% endfor %}
                </div>
                <input type="hidden" name="locale_code" value="{{ request.locale.iso_code }}" id="localeCode">
                {% endform %}
            </div>

            <!--container navigation contact info -->
            <div class="w-full px-2.5 py-5 flex flex-row items-center justify-between">
                <div class="w-auto h-auto">
                    <a class="flex flex-row items-start justify-start gap-x-1 font-(family-name:--submain-mobile-title-font-family) font-bold text-(--orange-color) text-[12px] leading-normal"
                        href="{{ section.settings.link_to_oniverse }}">{{ section.settings.link_to_oniverse_text |
                        default: "ONIVERSE" | upcase }}<span class="text-(--orange-color)">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-1.5 h-1.5" viewBox="0 0 19 20" fill="none"
                                stroke="currentColor">
                                <path d="M0 1H18V19" stroke="currentColor" />
                                <line x1="17.8635" y1="1.34331" x2="0.863507" y2="19.3433" stroke="currentColor" />
                            </svg>
                        </span></a>
                </div>
                <div class="w-auto h-auto lg:absolute lg:right-5">
                    <a class="text-(--link-color) text-[12px] font-(family-name:--submain-mobile-title-font-family) font-bold"
                        href="mailto:{{ section.settings.mail_to_email |  default: " mail@oniwines.it" }}">{{
                        section.settings.main_to | default: "mail@oniwines.it" | upcase }}</a>
                </div>
            </div>

        </div>
    </div>
</div>

{% style %}
.main-blur{
filter: blur(40px);
}
.fill{
fill: rgba(227, 219, 210, 1);
}


.menu-box .line {
position: absolute;
width: 14px;
height: 1px;
background-color: white;
transition: all 0.3s ease-in-out;
}

.menu-box .line1 {
transform: translateY(-3px);
}

.menu-box .line2 {
transform: translateY(3px);
}


.menu-box.active .line1 {
transform: rotate(45deg);
background-color: black;
}

.menu-box.active .line2 {
transform: rotate(-45deg);
background-color: black;
}
{% endstyle %}

<!--javascript code here-->
<script>
    document.addEventListener('DOMContentLoaded', () => {

        //handle submission form language site
        const languageButtons = document.querySelectorAll('.language-button');
        const localizationForm = document.getElementById('localization_form_tag');
        const localeCodeHidden = document.getElementById('localeCode');
        const activeLanguage = document.querySelector('.active-language');
        let localeCodeActive = null;

        function showLocaleActive() {
            languageButtons.forEach((button) => {
                if (button.getAttribute('data-locale-code') != localeCodeHidden.value) {
                    button.classList.remove('text-[#E3DBD2]');
                    button.classList.add('text-(--link-disable-color)');
                    activeLanguage.innerHTML = localeCodeHidden.value
                }
            })
        }

        showLocaleActive();

        async function setLocaleCode(localeCode) {
            if (localeCodeHidden) {
                localeCodeHidden.value = localeCode;
            }
        }

        languageButtons.forEach((button) => {
            button.addEventListener('click', async (event) => {
                event.preventDefault();
                localeCodeActive = button.getAttribute('data-locale-code');

                try {
                    await setLocaleCode(localeCodeActive);
                    localizationForm.submit();
                } catch (error) {
                    console.error(error);
                }
            });
        });


        //handle toggle menu
        const menuButton = document.querySelector('.menu-box');
        const navigationContainer = document.querySelector('.navigation-container');
        const mainContent = document.querySelector('main');
        const oniwinesLogo = document.querySelector('.oniwines-logo');
        const oniwinesLogoPath = oniwinesLogo.querySelectorAll('path');

        oniwinesLogoPath.forEach((path) => {
            path.classList.add('transition-all', 'duration-200', 'ease-linear');
        })


        menuButton.addEventListener('click', () => {
            menuButton.classList.toggle('bg-(--beige-menu)');
            navigationContainer.classList.toggle('hidden');
            document.body.classList.toggle('no-scroll');
            mainContent.classList.toggle('main-blur');
            menuButton.classList.toggle('active')
            oniwinesLogoPath.forEach((path) => {
                path.classList.toggle('fill');
            })
        });


        const targetLinks = document.querySelectorAll('[data-target]');
        const containersLinks = document.querySelectorAll('[data-child-link]');
        let isActive = null;


        const handleClickOnLinks = () => {
            targetLinks.forEach((target, index) => {
                target.addEventListener('click', () => {

                    if (isActive !== null) {
                        const previousTarget = targetLinks[isActive];
                        const previouslinkText = previousTarget.querySelector('.text-link');
                        const previousArrow = previousTarget.querySelector('.container-arrow');
                        const previousContainerLink = containersLinks[isActive];
                        const previousParenteElLink = previousContainerLink.parentElement;
                        const previousMainParent = previousParenteElLink.parentElement;

                        previousArrow.classList.remove('rotate-[90deg]');
                        previouslinkText.classList.remove('opacity-[0.3]')
                        previousContainerLink.style.height = '0px';
                        previousParenteElLink.classList.remove('flex-auto');
                        previousMainParent.classList.remove('flex-auto');
                    }

                    if (isActive !== index) {
                        const linkText = target.querySelector('.text-link');
                        const arrow = target.querySelector('.container-arrow');
                        const containerLink = containersLinks[index];
                        const parenteElLink = containerLink.parentElement;
                        const mainParent = parenteElLink.parentElement;

                        arrow.classList.add('rotate-[90deg]');
                        linkText.classList.add('opacity-[0.3]');
                        containerLink.style.height = `${containerLink.scrollHeight * 2}px`;
                        containerLink.classList.add('max-h-[170px]');
                        parenteElLink.classList.add('flex-auto');
                        mainParent.classList.add('flex-auto');
                    }

                    isActive = (isActive === index) ? null : index;
                });
            });
        }

        handleClickOnLinks();


        // Display menu item active on page load;
        const path = window.location.pathname;
        const pathSegments = path.split("/").filter((segment) => segment !== "");

        const mainLinks = document.querySelectorAll('.main-menu-link');
        const mainSubLinks = document.querySelectorAll('.main-menu-sublink');
        const allLinks = [...mainLinks, ...mainSubLinks];

        const setActiveLink = (link) => {
            const containerArrow = link.closest('.w-full')?.querySelector('.container-arrow-link');
            if (containerArrow) {
                containerArrow.classList.remove('hidden');
                containerArrow.classList.add('text-(--orange-color)');
                containerArrow.classList.add('mr-[20px]')
            }
            link.classList.add('text-(--orange-color)');
        };

        if (pathSegments.length === 0 || (pathSegments.length === 1 && (pathSegments[0] === "it" || pathSegments[0] === "en"))) {
            allLinks.forEach((link) => {
                if (link.innerHTML.toLowerCase() === "home") {
                    setActiveLink(link);
                }
            });
        }

        pathSegments.forEach((segment) => {
            let newSegment = segment.replace(/-/g, " ").replace(/cantina/g, "").trim().toLowerCase();

            allLinks.forEach((link) => {
                const linkValue = link.innerHTML.toLowerCase();

                if (linkValue.includes(newSegment)) {
                    setActiveLink(link);
                }
            });
        });

    })
</script>